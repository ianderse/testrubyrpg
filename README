This is old and terrible code, please do not read :).
